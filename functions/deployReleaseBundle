function deployReleaseBundle() {
  local useHSQL="false"
  local startLiferay="true"
  while [ "$1" != "" ]; do
    case $1 in
    -h | -help)
      _showHelp "$0"
      return 0
      ;;
    -hsql)
      useHSQL="true"
      ;;
    -ss | skipStartLiferay)
      startLiferay="false"
      ;;
    *)
      echo "Invalid option '$1'"
      _showHelp "$0"
      return 0
      ;;
    esac
    shift
  done

  if ps -eo command | grep "$PATH_TO_BUNDLES" | grep -v grep > /dev/null
  then
    echo "Liferay Running. Let's stop it first.."
    stopLiferay
  fi

  cd "$PATH_TO_PORTAL/" || return 1
  if [ "$useHSQL" = "false" ]; then
    cp "$LIFERAY_ZSH_INSTALLATION_PATH/util-files/portal-ext.properties"  "$PATH_TO_BUNDLES/portal-ext.properties"
    case $(uname) in
      Darwin)
        sed -i '' "s/%JDBC_USER%/$MYSQL_USER/g" "$PATH_TO_BUNDLES/portal-ext.properties" && \
        sed -i '' "s/%JDBC_PASSWORD%/$MYSQL_PASSWORD/g" "$PATH_TO_BUNDLES/portal-ext.properties"
      ;;
      Linux)
        sed -i "s/%JDBC_USER%/$MYSQL_USER/g" "$PATH_TO_BUNDLES/portal-ext.properties" && \
        sed -i "s/%JDBC_PASSWORD%/$MYSQL_PASSWORD/g" "$PATH_TO_BUNDLES/portal-ext.properties"
      ;;
    esac
  fi

  cp "$LIFERAY_ZSH_INSTALLATION_PATH/util-files/portal-setup-wizard.properties" "$PATH_TO_BUNDLES/portal-setup-wizard.properties"
  case $(uname) in
    Darwin)
      sed -i '' "s+%PATH_BUNDLES%+$PATH_TO_BUNDLES+g" "$PATH_TO_BUNDLES/portal-setup-wizard.properties"
    ;;
    Linux)
      sed -i "s+%PATH_BUNDLES%+$PATH_TO_BUNDLES+g" "$PATH_TO_BUNDLES/portal-setup-wizard.properties"
    ;;
  esac

  if [ "$startLiferay" = "true" ]; then
      startLiferay || return 1
  fi
}

_showHelp() {
  echo "Function help:"
  echo "$1 [options]"
  echo " "
  echo "options:"
  echo "-h | -help,             Show brief help"
  echo "-hsql,                  Use hsql data base instead of MySQL"
  echo "-ss | skipStartLiferay, Skip start Liferay after mount the bundle"
}

deployReleaseBundle "$@"